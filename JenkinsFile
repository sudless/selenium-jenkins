pipeline {
    agent any

    tools {
        maven 'mvn'
        jdk 'jdk'
    }

    options { timeout(time: 30, unit: 'MINUTES') }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

    stage('Test (matrix)') {
        parallel {
            stage ('Chrome') {
                steps {
                    sh 'mvn -B clean test -Dbrowser=chrome -Dheadless=true'
                }
            }
            stage('Firefox') {
                steps {
                    sh 'mvn -B clean test -Dbrowser=firefox -Dheadless=true'
                }
            }
        }
     }
  }


 post {
    always {
          // Publish BOTH: Surefire (if any) and Cucumber JUnit XML
        junit testResults: '**/target/surefire-reports/*.xml, target/cucumber-report/cucumber.xml',
              allowEmptyResults: true

archiveArtifacts artifacts: 'target/cucumber-report/**/*', allowEmptyArchive: true    }
  }
}
