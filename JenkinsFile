pipeline {
    agent any

    tools {
        maven 'mvn'
        jdk 'jdk'
    }

    options { timeout(time: 30, unit: 'MINUTES') }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

    stage('Test (matrix)') {
        parallel {
            stage ('Chrome') {
                steps {
                    sh 'mvn -B clean test -Dbrowser=chrome -Dheadless=true'
                }
            }
            stage('Firefox') {
                steps {
                    sh 'mvn -B clean test -Dbrowser=friefox -Dheadless=true'
                }
            }
        }
     }
  }


 post {
    always {
        junit '**/target/surefire-reports/*.xml, **/target/cucumber-reports/*.xml'
        archiveArtifacts artifacts: 'target/**/*', fingerprint:true
    }
  }
}
